import { ModuleInterface, ModuleType, WalletNetwork } from '../../types';

declare const window: Window &
  typeof globalThis & {
    rabet?: {
      connect: () => Promise<{ publicKey: string }>;
      sign: (xdr: string, network: RabetNetwork) => Promise<{ xdr: string }>;
    };
  };

export const RABET_ID = 'rabet';

export class RabetModule implements ModuleInterface {
  moduleType: ModuleType = ModuleType.HOT_WALLET;

  productId: string = RABET_ID;
  productName: string = 'Rabet';
  productUrl: string = 'https://rabet.io/';
  productIcon: string =
    'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxMjhweCIgaGVpZ2h0PSIxMjhweCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDEyOCAxMjgiIHhtbDpzcGFjZT0icHJlc2VydmUiPiAgPGltYWdlIGlkPSJpbWFnZTAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB4PSIwIiB5PSIwIgogICAgaHJlZj0iZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFJQUFBQUNBQ0FZQUFBRERQbUhMQUFBQUJHZEJUVUVBQUxHUEMveGhCUUFBQUNCalNGSk4KQUFCNkpnQUFnSVFBQVBvQUFBQ0E2QUFBZFRBQUFPcGdBQUE2bUFBQUYzQ2N1bEU4QUFBQUJtSkxSMFFBL3dEL0FQK2d2YWVUQUFBUgo0VWxFUVZSNDJ1MmRlM1FVVlo3SHY3L3FoTHg1dnhLamdwb0JFa2lFTkpBSE1DZExTQVJDd0tnRWQyRjJkc2VabzJmWDJlUEtpRFB5CmlJb2dJcWpydkhSY1ozUjNkV2FIZFJuSE15YmRIWHJ3a0U2Q1dSR1krSW9DTTRnWVhVTWdKQ1Q5cU4vK0VYRkRUTHFycW05VjNWWSsKNStTUGRGZmQrLzFWZit0M3ErNjlkWXNnQWN4TXJucmZuV0RjQXdCRXRMMnN0T2duZHVzU2hkdmRPQ09FME5NQTVRRjRoVWJFYnlqLwo1cnlUZHVzQ0FMSmJBQUM0WEFkdVU0RmZYQ0xNNGFnc1gxejRlN3UxUll2UDUwdnFPcSsyTWpEMWk5aUlXc3FYRk0rMVd4c0FLSFlMCkFBQ1ZhTVdYUGd5cHUxdGFXdUx0MWhZdDUzdXdmdUNQRHdETTdQUjRtaWJaclEyUXhBREVmUFhnenhoODNXZG5ldi9SYm0zUjRQVWUKbk15czNqUFVkMEZTcjlaYm5obElZUUFtWERIazU0eE50VDdmV0x2MUdjVWZERHpFak5TaHZsTXdkTXhXWTdzQjJ0cmFFc0FZUDh6WApZK2c4YjdGYm94RThucVpjWm54N3VPOVY5YklCQUFESFB1cklDTHNCNFE2UHAva2JkdXZVUzVDRHV3QWU5dmdxeEpsMmF3UWtNSUFqCkVBaDdJSmc1UHNqQm5YYnIxRU5kZmVNS01FckR4blU1QS9RVEFrVStFTXlWdFo0REpYWnIxWUxYeTNFSXFZOUUzSkF1R3dDQTlqT0IKVk5yTnpMYnJqWVEvNkx1RHdkTWp4ZzIrYkFBQUlOS1FBUUF3K0hxWHAvSGJkdXNOaDl2ZE1vckJtelhGelpjekFBQ0FvV28rRU16cQoxcnJEaDFQczFqd2NJZTdiSE9hT1psRGNTUEY2RDQyMlc3UHRCaUFtUFZmRDZkemV0Y0Z1elVQaDhieCtEUUJkSFZmTUFkdXpnTzBHCllOMFhRM1MzMTlza3hTM1VRSUxjdHhQZ0VmcjIrWm9iZ0prSmpIU2RleVgzQlVQYjdOUTlHTGU3YVFFWVZYcjNrNkV6eUZZRHVIeSsKQ1hyUEdnQWdZSzNMZGNCcHAvYUxNRE9GRU5wdFpGK1NvRHZZVmdNb1BkcnVBQWJEektRU0dUcm9vbkc3Zld2QmJHeG9sKzN2RGJUVgpBR28wblNITUMydmREVGZacWQvbjh5VXgrQ0hEQldpOEJUWVRXdzFBcWhydEdiQ2p0YlZWZHhNaWlzL0grcTgwdWo5LzNac0FqdllNCllMNzI1S25PTyszUUhtNnNYeXN5ZEFiWm13RUVuQUZFdk5IamFSNW50Zlp3WS8wNkRzQUVPek1ZWVBjMUFCRDFaQTltakZZNVVHT2wKN2toai9kcTFNNTArM1RYR1N1MkRzVHNEakJSUkRnTzMxM2w5RVFkZ1JCSGswTzV3WS8yNnluS29hVmJwSGdxN2V3S0ZCTStNT0FUWgpramtEL1dQOXZGaFVlZkVxQ1RrSmpHTHZSU0JZV1BETVhPRnkrWVQ5TUVPaGVheGZCNm9xSmdzYXhlNE1JRFI0bFZSVDV3eG9IZXZYCnBWa1Jrd1dOWXZjMVFIUlgwWU5oNUxyZERYOXZodGJQaDI2RlQxQmxsYisrQmdDb1QzU0pLdUZCcjdkVnJMRUE5QVY2TmpHekNiZWIKTFB3WTZNRmVBekNmRTE4bUp2dURuZmVLTExLK3Z1RmE2QnpyMXdxUlEvd3gwSUhkMXdCbUJmL1BkZnNQR3U2aUhVeEE1VWVNakZwcQpRakhoSk5CVHZaMlZNNUVwd1ROekV2eUI3U0xLTWpyV3J4V0hTbDFtbGEyRnIyb0dBSUMvcnEzM3pZdW1BR1ltRmFISHpEd0FEb2VwCnh5QWlkdDhGZEpwVk5qTVRoZFNvNWd5NDNiNjF6R3p5eEpNMDA0NkJGdXpPQU8rYldUZ0R4UzZYN3hZaisvcDh2aVFWTUhmcUdlSGoKa3BLYzg2YldFUUY3WndSQmVjdnNPaGpxanJhMnRnUzkrNTN2d1hyQTNCazd4R1I2L0pHd2R6UXdUclhBQUpoNjdFVDc5L1hzSTJLcwpYd3RFL1BVMlFPYkUwZThCQ0psZkU5M245YlpvZW1BREVEVFdyd0VtZXR2ODJNTmpxd0Z5Y25MOElETDFPZ0FBbUhtVVA5aDN2NVp0CmEvYzE1NGtZNjllQ3d1WTNnUkUxMkMyQUdFZXNxWW0vNTNZM3pvaTRXU2o4Yy8zQzRpWmlJdVdvTmJFUGorMEdnRUllSzZwaFJwd0sKOWRGdzI0Z2U2dytyQnpoVVdqci9NeXZxQ29mdEJvZ2pyck9xTG1aZVZ1ZHBXakxVZDE0dng3R3FXcllRQmJGMWNZZkRkZ01zWGx6OApaeEM5YTFtRkhOckZ6STdCSC91RHZqdkFQTTBxR1FvNVhKYkZIRTZIM1FJQWdBRExEZ1l6ejNMVk4zNW40R2RtamZVUEd5L2gvSmd4CjhRMVcxUmNPS1F5Z0FOYW1RK1lIRGh3NDhNVkVEUFBHK29lckgxNm4weG13Tk9aaGtNSUFLU20wajRCdXErcGo1a25kUGZnaFlPNVkKLzdEMUUwbXpCSzRVQmlncUtyb0FvbGNzclpSd1YzMTl3OVdtanZVUFZTMGhtQkNYOE4rV3hob0dLUXpRTDBUNVR5dnJZMFppNTluegpENXM1MWo5MHhmQ1dsRGovMTlJNnd5Q05BVkpTK0ZVaVdEWXlSa1JjVTdOaDFxRkRMWCt5TWs0Q0xEVjZKS1F4UUZGUjBRV3dkYzNBCmllTWZOQnc5OG1iTzFnZnVzeXhHSWdRVkpWNmE5QTlJWkFBQUlBZFpkSFpReitaTjkxd0xBTjNkM1ROZjJ2TWJueFcxTXFoZWh0Ni8KZ1VobGdIZ2wzWkptb09IQUg1dmIyei8rWW0yaVo1NzU2VlYrdjkvMDZkbEU5RnV6NjlDTFZBWW9LWm5heXpEM0ZrbGxidCs1YytzbApjd1ZWTlpUNUwwL3NiRFN6WGlJRU9SbFNwWDlBTWdNQUFKRzV6Y0FMLy83c2U3MFhMbnhwc1VtUCs5VTVuV2ZPZkdwaTFaNGJpb282CnpJek5DTklaWUlRanZSWmt6bFRwdnQ2K2QxLzRqK2VLaC9sNlpNMldEU1pPMEZDa1MvK0FoQVlvS1puYVMyQlRtb0Vkajl6ZnJhcnEKc0RHLzg4NWJ4VzF0N3dpZm9FSkVBVTdCWGpOaWloYnBETkF2U253ejhNa243YzIrQTYvTmliQ1pZOHVtRFozQ0EyS1dNdjBEa2hwZwp5cFNKUXBzQklncHMzdmlEaVZxMjdlajR6T24xdWx0RXhzTVNYdjFmUkVvRFpHVmw5Ukh3c3FqeWpoeCtvK0hFaVdOVHRXNy8ySzd0ClkwS2hrSkRKcWtRVVNFbE0yMnZDWVJLQ2xBWUFBR0lXMUF4dzU0TVBic3pUczRmZjc3LzJWNzk4V3RSNHZYdmh3dHd6Z2crUE1LUTEKd05TcGsrcUE2QjhlZmVYbHZXK2VPM3RXOTBwY2UzNzdRblpQVDNmVTlaTUNhZE0vSUxFQnNyS3kra0Q0WFRSbGhFTEJFei8vK1JQRgpSdlpsNXZIYkh0cnlSblJSa0Q5ZVNkNXIya0VTZ0xRR0FBQlNvcnQzL3NtVHV6OE9Cb09HWHovYjhucFQ0YW1QVG4xb1BBQzRTMHBtCmQ1cDNoS0pIYWdOY2M5VjRGeEdkTmJKdlY5ZTVRMy80dzhzRlVVcEkySHpmM1liZjhrMGtaK2ZQUUtRMlFGWldWaC9BQnBvQlVtczIKYjBnVW9lSFVxUThMRDczeHVvRUhPTWcvd3BFWVZSTm1CVkliQUFCZzRDdzZmdXlEaHRiV281R2ZBdExJZ3c5c1ZBQ3dMdGtFbCt6cApINGdCQTJTbWo5TFZEQkRRdlhuVCt1dEVhdWpwNmM3NXJ6MHY2aG90SkpacjVzOXdTRytBbkp3Y1A1ajNhdDErLy81OUJ6Lzk5Qk9kCjd5R0t6TDgrODdPckFnRi9yN2F0eVUrVUlLd2p5MHlrTndBQUtCcTdVcG41OU81ZDIrYWJvVUZWMWN6SEgzdWtTY3UyQks1YnNzUnAKNk9MVmFtTENBQmtabzkxRWtkY1RldjY1Wno3bzdlMU5Oa3RIdmFjMi8weEhSOFE1QTZSWU5iVXRlbUxDQURrNU9YNW0yaHR1bTk3ZQpDMi8vK3NYbkRYWDY2Q0J0UzAzRU9RTjlJMU1kTVpIK2dSZ3hRTDlRRHRzTWJOOWUwOGZNWkxhTzk5NTV1N2l0N2QyMllUY2dxaXNvCktMQjE2VGM5eEl3QnhvNU5kQU1ZY2xDbHZmM2pwdWJHaHVzdGt1TFlzdWtIdy83QVJLSUdzYXdoWmd6Z2REb0RDZzNWREpCLzA4YjEKazYzVTB0SFJrZSt0cjN0OWlLLzZScVhHU2ZQY254Wml4Z0FBd0VPTURiejU1di80L3ZMbkUxT3MxdkxZWXp1K1BHZUFxRGFXMGo4UQpZd1lZTnlyZWcwdWJnWTZISHR4NHZSMWEvSDcvZGI5NjlxbEJjd1ppNStyL0lqRmxBS2ZUR1NDaUwrYlcvMjd2bnFOZFhlZEcyNlZuCno1NFhzN3U3dTg4Q0FCRjZVNVBVbUVyL1FJd1pvRjl3LzFrV0RJYU9QZjNVajR2czFNTE00N2MvdFBsUS8zOVV1MkRCQWx0WC9qWkMKekJrZ0xxNndua0FkVHo3NTZLZWhrUEd4ZmxHMHREUVhmblRxNUVuaTJFdi9NVXZOL2R1M29uOTBUb3EvOVBTTTE4eDRUWTBWeEZ3RwpZR2Fscy9OTWx0MDZCdUtjV3hEdlY4L20ycTNEQ0RGbkFGZDk0OStWbFMrdklpSnBIck5lVlhVTEk2VHV0cUluVWpReFpRQ3Z0eldWCldkMnFLSTY0ckduVFcrM1dBd0NKaVlrWE1qT3V6R1ZndnR2ZHVNWnVQWHFKS1FQNGc1MGJ3SmdNQUt1cjEwclI1cGFWTHovTVFBb0EKcU1UYnZkN2pRcWFpV1VYTUdNRHJiY29FY1BmRi93c0xGdVFSa2UyTExhMjZjZlgvVHhWanZ0b2ZPbjJYM1pyMEVETUc4QWRDMjVrNQo2ZUwvRG9mRE1XM2FERnVYVzA5TVRMeVFrWkY1eVZOSHpQeERqNmRwa3AyNjlCQVRCbkM1RGpoQitKdkJuMWZiM0F5VWw2ODREUENsCkUxQ1kwMEljZXNCT1hYcUlDUU9vUkVOZVljOHJLTTRqSWpOWDlRakxxaHR2SHZKelp2NU9uYmRocGwyNjlDQzlBV3JkRFRlQmVlRlEKM3prY0RzZjA2ZG0yTkFPSmlZazk2Um1adzkzN094REFManQwNlVWcUE3UzJ0bzRBc0NQY050VnIxZ2w5QmIxV2xpNnQvSEw2SHdDRAp5K3JxRzVmYW9VMFBVaHZnNUtuT084RjhiYmh0NXMwdnlpV2lUNnpXdG5MVnpSRTdmVmdOUFRyVXV3bGtRbG9EZUR6TjQ0aDRZOFFBCkZNVXhQVHZIMHJkdkpTWWw5VXhPdnlKeTF5OGoyK1h4ZmM5S2JYcVIxZ0FxQjJxWU1Wckx0dFhWYXkxdEJwWXVYUkUyL1ErRW1lOTMKdTF0R1dhbFBEMUlhb003cm04N0E3VnEzbnpldk9NL0tacUJ5MWMxNmp0dUVFUGY5eUNwdGVwSFNBQWp5VG1iRWFRNUNJU1U3ZTZZbAp6VUJpVWxKM2hwYjBmd244VDNYN216V3ZVV1FsMGhuQTVmSjlrNWtyOU82M2VzMDZTOUxzc3VVcmp3enNrZFJJQXZ5QnJWYm8wNHQwCkJtRGk5VWIybXp1M01KZUkyczNXVjdteXl1aVE3K3E2L1Fldk5GdWZYcVF5UUszWGR4MkE1WVlDVVVqSnlabjFqcG42a3BLU3U5TW4KWDZGcnhiR0xNQ09PK3dLV3ZwdElDMUlaZ0lMOC9XZ21WVlNiM0F3c041YitCOERmYldscE1lM2hWU05JWlFBd3FxUFpQZDlaWUdvegpzS0t5S3Ryak5lYXpUbitaV2ZxTUlJMEJ2TjdHS1F6V3RKenJzTUdZMkF3a0pTV2ZuNXllYmlqOVh3S3JwcXhmWUJScERCQU1ZbDcwCnBRRFZhNzQxMmd4OXl5dFdIV1ZHOUxOOW1JVEVLUXBwREtBaU5GZEVPYzY1QmJPSWxJOUY2NnVNUHYwREFKZ2dKRTVSU0dNQWdNWUsKS1lXZ3pKeVpLN1FaU0U1T1BqOXA4dVRvMHo4QU1LZDV2YXk1azh0czVER0F3Rkd6Nmx2WDZWNGJPQnpMbHQ5NFJFajYvNXpNelBlbApHU0dVeHdCRXdzNEtwM04rcnFJb3AwV1ZWN215U3VnUGRxeW41M0lHK0JMTVFZR2wwYXhaZWUrS0tDZzFOYlZyNHNSSjF3c1RSc1FqCk9rWUtlUmVCQ0tReEFDa2tkR3JYNnVwMVFxNHBsaTVmZVJSQWdqaGxmTHlrWktyRzlRYk5SeDRETUIwV1dWNitjOTRzUlZFK2lyYWMKRlpVM2lVM1hES0Z4Um9zMEJraElHSEZFY0pFMEszZjJlOUVVa0pxYTJqVnh3a1F4Vi85ZnFDTFJjVWFGTkFaWXRNaDVta0JDMytTOQpKc3BtWUhuRnFpTVFtdjRCS09RU1dsNjBjdXdXTUJBQ1BTT3l2Tm41enFpYWdSVXJxb1F1UUVGRWI1Y3ZMckxrUmRWYWtjb0FhaXIrCkRZRElsemhUYnA2eFppQTFOZlhjZU1IcG53aENEUzRDcVF6US8zSkZlbEZrbWRWcnZqWE95SDRWRlZWaXIvNkp1dUlkQ2MrTGpFMEUKVWhrQUFPSVV4NzBZWmtWUUk4eWVuVDlUVVpSVGV2ZXJXTEZxaE5qSTZFY2xKVTdibjJZZWpIUUdLQzB0YUNkU0RFMExHd2JLeTV2VApwbWVIMU5TMGMrTW5UQktXL29uUVZGNWErRk9CTVFsRE9nTUFRUG1Tb21jSjRxNldWOSs2YnJ5ZTdTc3FxNDRDTENnRFVBL2k2THRFCnBJbzlTbUtRMGdBQWtKTE1OeFBRTEtLc09iT2RPWXFpYUg3OW04RDAzeGVuS0N2TFM0cUYzdDZLUkZvRExGaXdvQ3M1YWVSU1F2UTkKWjh4TWViUHpOYjBXUGkxdDVObng0NksvK2llaUFEa2N0NVNXRm5xc09GNUdrZFlBQUxCd1llNlpwTVRrSlFUYUYyMVp0NjdSMWd5cwpxS3o2VTdUcG40ZytBMUZWK2VKQzZaZU9sZG9BQUxCbzBaeFB5NVlVbFlLVXU0aGdlQkFsTjIvT1RJZkRFZkVsa0JVVnE2SzY5U1BnCjFhU0VoRm5scFVXdjJIRzg5Q0s5QVlEK0lkUWJsaFE5N3FDNGZBSVo3a2tyTGIzaGczRGZYNUY1NWNteDR5Yk1NYVFSMUtFb3l1M2wKWlF1V0xWcmtGRFlYd1d4aWJtRkRBS2p6Tk56TWpJY2pyUjB3bUs2dWMyZHV1V2taQUF3NVkranhKMy94MnZScE14YnBVME4rQUQ5TwpTVXJiS3ZOcjRvY2pKakxBWU1wTGkvZGNtVEU2RzZUY1JhQU9yZnVscFkwY2M5dHQvekRrdklQNUJjV0haMHpQWHFpMUxBQWdvdDlRClF0ejBHOHFLNzQ3Rkh4K0kwUXd3RUsvMzBHaC9zUHMrWnR3SmpWMjNHemV1OTdZY2JDcTUrUCtVS2RjYy85bFR6NlVRa2JibkVnZ0gKeU9GWVgvNVhoVUp1VSswazVnMXdFYSszY1VwZlVOMUd3Qm90ajVjOS9IQ045NC83UEl2eTgrZSt0WFhiN2dsRUZQRzlRMFRVcGtDNQpkOG1Td3Bmc2psY1VYeGtEWE1UamFaZ2JZbXhtNXFVQXdrem1wQTg5cnQvdktDMnJ1SUdJbG9VekRZSGVaNklueG84WjhaVFQ2UXpZCkhhTkl2bklHdUVoOXZlK0tVRWo5V3dhY0FES1lhRHdCZjJIbXR4emtlQzB1cnVDbGtoSUtBb0RIMDVTdFFxMW1sYk1aUEFPRUVFQ24KQVRxdU1INWRWbGEwMys1NExuTVpVL2cvTTQ4OTd1a0kzalFBQUFBbGRFVllkR1JoZEdVNlkzSmxZWFJsQURJd01qSXRNVEV0TWpCVQpNREU2TVRrNk1qWXJNREU2TURBOU1md0dBQUFBSlhSRldIUmtZWFJsT20xdlpHbG1lUUF5TURJeUxURXhMVEl3VkRBeE9qRTVPakkyCkt6QXhPakF3VEd4RXVnQUFBQUJKUlU1RXJrSmdnZz09IiAvPgo8L3N2Zz4K';

  async isAvailable(): Promise<boolean> {
    return !!window.rabet;
  }

  async getPublicKey(): Promise<string> {
    if (!window.rabet) {
      throw new Error('Rabet is not installed');
    }

    const { publicKey } = await window.rabet.connect();

    return publicKey;
  }

  async signTx(params: { xdr: string; publicKeys: string[]; network: WalletNetwork }): Promise<{ result: string }> {
    if (!window.rabet) {
      throw new Error('Rabet is not installed');
    }

    if (params.network !== WalletNetwork.PUBLIC && params.network !== WalletNetwork.TESTNET) {
      throw new Error(`Rabet doesn't support the network: ${params.network}`);
    }

    if (params.publicKeys.length > 0) {
      console.warn(`Rabet doesn't allow specifying the public keys to use`);
    }

    const result = await window.rabet.sign(
      params.xdr,
      params.network === WalletNetwork.PUBLIC ? RabetNetwork.PUBLIC : RabetNetwork.TESTNET
    );

    return { result: result.xdr };
  }

  // @ts-expect-error - This is not a supported operation so we don't use the params
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  async signBlob(params: { blob: string; publicKey?: string }): Promise<{ result: string }> {
    throw new Error('Rabet does not support signing random blobs');
  }

  // @ts-expect-error - This is not a supported operation so we don't use the params
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  async signAuthEntry(params: { entryPreimageXDR: string; publicKey?: string }): Promise<{ result: string }> {
    throw new Error('Rabet does not support signing authorization entries');
  }
}

export enum RabetNetwork {
  PUBLIC = 'mainnet',
  TESTNET = 'testnet',
}
